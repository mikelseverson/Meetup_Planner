<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-document.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">


<dom-module id="fire-create">
  <template>
    <firebase-auth id="firebaseLogin" user="{{user}}" status-known="{{statusKnown}}" location="https://meetupdb.firebaseio.com/" provider="password" on-error="errorHandler" on-user-created="userSuccessHandler" on-password-changed="userSuccessHandler" on-password-reset="userSuccessHandler" params="{{params}}" on-user-removed="userSuccessHandler"></firebase-auth>
    <firebase-document location="https://meetupdb.firebaseio.com/datac" id="firebaseDocument"></firebase-document>

    <paper-slider min="0" max="100" value="30" disabled style="width: 100%;"></paper-slider>

    <h2 class="page-title">Join us!</h2>
    <paper-input label="What is your name?" value="{{params.name::input}}"></paper-input>
    <paper-input label="Email" type="email" value="{{params.email::input}}"></paper-input>
    <paper-input label="Create your password" type="password" value="{{params.password::input}}"></paper-input>

    <h3 class="page-title">Optional</h3>
    <paper-input label="Who is your employer?" value="{{employer::input}}"></paper-input>
    <paper-input label="This that this" value="{{employer::input}}"></paper-input>

    <paper-button raised on-tap="createUserHandler" style="width: 100%;">Create</paper-button>
        <paper-toast id="toast" text="User Created!"></paper-toast>
  </template>
</dom-module>


<script>
(function () {
  'use strict'
  Polymer({
    is: 'fire-create',
    properties: {
      params: {
        type: Object,
        value: {
          email: '',
          password: ''
        }
      },
      provider: {
        type: String, value: 'password'
      }
    },
    errorHandler: function (e) {
      this.log('Login Status')
      this.message = 'Error: ' + e.detail.message
    },
    userSuccessHandler: function (e) {
      this.message = e.type + ' success!'
      this.toastHandler("Welcome!");
    },
    toastHandler: function (message) {
        this.$.toast.text=message;
        this.$.toast.open();
    },
    createUserHandler: function (e) {
      this.$.firebaseLogin.createUser(this.params.email, this.params.password);
    },
    computeCreateUserDisabled: function (email, password) {
      return !email || !password
    },
    computeLoginStatus: function (statusKnown, user) {
      this.log('Login Status')
      if (statusKnown && user) {
        return 'Logged in'
      }
      if (statusKnown) {
        return 'Logged out'
      }
      return 'Unknown (checking status...)'
    },
    log: function (log) {
      var d = new Date()
      var n = d.getTime()
      this.$.firebaseDocument.query.ref().push({log: log, time: n, user: this.user})
    },
    getUserDataUrl: function (uid) {
      return 'https://meetupdb.firebaseio.com/users/' + uid
    }
  })
})()
</script>